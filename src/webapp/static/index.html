<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PKMN Autoshine - Macro Control</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/shell/shell.min.js"></script>

</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-left">
        <h1><i class="fas fa-gamepad"></i> PKMN Autoshine</h1>
        <p class="subtitle">Advanced Pok√©mon Macro Automation Control</p>
      </div>
      <div class="header-right">
        <button id="settings-toggle" class="settings-btn" title="Settings">
          <i class="fas fa-cog"></i>
        </button>
      </div>
    </header>

    <!-- Macro Status Section -->
    <div class="card macro-status-panel">
      <h2><i class="fas fa-chart-line"></i> Macro Status</h2>
      <div class="status-section">
        <div class="status-item">
          <span class="status-label">Iteration:</span>
          <span class="status-value" id="iteration_count">0</span>
        </div>
        <div class="status-item">
          <span class="status-label">Runtime:</span>
          <span class="status-value" id="runtime_display">0:00</span>
        </div>
        <div class="status-item">
          <span class="status-label">Time/Iteration:</span>
          <span class="status-value" id="time_per_iteration">--</span>
        </div>
      </div>
    </div>

    <!-- Macro Controls Section -->
    <div class="card macro-control-panel">
      <h2><i class="fas fa-play-circle"></i> Macro Controls</h2>
      
      <!-- Macro Selection -->
      <div class="controls-section">
        <div class="macro-selector">
          <div class="form-group">
            <select id="macro_select">
              <option value="">Choose a macro...</option>
            </select>
          </div>
        </div>
        <div class="macro-actions">
          <button id="run_macro" class="success"><i class="fas fa-rocket"></i> Run</button>
          <button id="run_once" class="primary"><i class="fas fa-play"></i> Run Once</button>
          <button id="pause" class="warning"><i class="fas fa-pause"></i> Pause</button>
          <button id="force_stop" class="danger"><i class="fas fa-stop-circle"></i> Force Stop</button>
          <button id="edit_macro" class="secondary"><i class="fas fa-edit"></i> Edit</button>
          <button id="new_macro" class="secondary"><i class="fas fa-plus"></i> New</button>
        </div>
      </div>

    </div>

    <!-- Live Logs -->
    <div class="card logs-panel">
      <div class="logs-header">
        <h2><i class="fas fa-terminal"></i> Live Logs</h2>
        <button id="clear-log" class="btn-small"><i class="fas fa-trash"></i> Clear</button>
      </div>
      <div class="logs-content" id="log">Waiting for connection...</div>
    </div>
  </div>
  <!-- External JavaScript modules -->
  <script src="/static/app.js"></script>
  <script src="/static/app-functions.js"></script>

  <!-- Macro Editor Modal -->
  <div id="macro-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title"><i class="fas fa-code"></i> Edit Macro</h2>
        <button class="modal-close" id="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="macro_name">Filename:</label>
          <input id="macro_name" type="text" placeholder="Enter filename.txt" style="width: 100%;">
        </div>
        <div id="editor-wrapper">
          <textarea id="macro_editor" placeholder="# Enter your macro commands here...
# Available commands:
# PRESS <button>     - Press and release a button (a, b, x, y, l, r, zl, zr, plus, minus, home, capture)
# HOLD <button>      - Hold a button down (without releasing)
# RELEASE <button>   - Release a button that was held
# STICK <stick> <x> <y> - Move analog stick (l or r, coordinates -1.0 to 1.0)  
# SLEEP <seconds>    - Wait for specified time
# LOOP <count>       - Start a loop (repeat commands until ENDLOOP)
# ENDLOOP           - End a loop
# 
# Example:
# PRESS a
# SLEEP 0.5
# HOLD r     # Hold R button
# PRESS b    # Press B while holding R
# RELEASE r  # Release R button
# LOOP 3
#   STICK l 0.0 1.0
#   SLEEP 0.1
# ENDLOOP"></textarea>
          <textarea id="mobile-fallback-editor" class="mobile-fallback-editor"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button id="save_macro" class="success"><i class="fas fa-save"></i> Save</button>
        <button id="cancel_edit" class="secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-cog"></i> Settings</h2>
        <button class="modal-close" id="settings-close">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Alert Configuration -->
        <div class="settings-section">
          <h3><i class="fas fa-bell"></i> Notifications</h3>
          <div class="form-group">
            <label for="alert_interval">Interval (0 = off):</label>
            <div class="input-with-unit">
              <input type="number" id="alert_interval" value="0" min="0" max="10000" step="1" style="width: 80px;">
              <small>iterations</small>
            </div>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="enable_notifications" checked> Browser alerts
            </label>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="enable_sound" checked> Sound effects
            </label>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="pause_on_alert"> Pause on alert
            </label>
          </div>
          <button id="set_alerts"><i class="fas fa-save"></i> Apply</button>
        </div>

        <!-- Metrics Configuration -->
        <div class="settings-section">
          <h3><i class="fas fa-chart-bar"></i> Metrics</h3>
          <div class="form-group">
            <p>Reset iteration count and runtime back to zero:</p>
            <button id="reset_metrics" class="danger"><i class="fas fa-undo"></i> Reset Metrics</button>
          </div>
        </div>

        <!-- Adapter Configuration -->
        <div class="settings-section">
          <h3><i class="fas fa-plug"></i> Adapter</h3>
          <div class="form-group">
            <label for="adapter_select">Controller Type:</label>
            <select id="adapter_select">
              <option value="">Auto-detect (Pico first)</option>
              <option value="pico">Pico W (USB Serial)</option>
              <option value="joycontrol">Joycontrol (Bluetooth)</option>
            </select>
          </div>
          <div class="adapter-status">
            <div class="status-item">
              <span class="status-label">Adapter:</span>
              <span class="status-value" id="adapter_status">Checking...</span>
            </div>
            <div class="status-item">
              <span class="status-label">Console:</span>
              <span class="status-value" id="console_status">Checking connection...</span>
            </div>
            <div class="status-item">
              <span class="status-label">Status:</span>
              <span class="status-value" id="macro_status">Ready</span>
            </div>
          </div>
          <div class="button-group">
            <button id="set_adapter"><i class="fas fa-check"></i> Apply</button>
            <button id="test_adapters"><i class="fas fa-search"></i> Test</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="settings_save" class="success"><i class="fas fa-check"></i> Close</button>
      </div>
    </div>
  </div>
</body>
</html>
